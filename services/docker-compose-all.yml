version: "3.5"
services:
  authservice:
    image: authservice:1.2
    ports:
      - "4005:4000"
    environment:
      PORT: 4005
      DB_HOST: postgres
      DB_PORT: 35432
      DB_USER: postgres
      DB_PASSWORD: 123456
      DB_NAME: librarydb
    volumes:
      - authservice-code:/app
      - authservice-node-modules:/app/node_modules
    command: npm run dev

    networks:
      - library-network
  client:
    ports:
      - "3000:5173"
    build: ./client
    environment:
      VITE_BOOKSERVICE_PORT: 4001
      VITE_CATEGORYSERVICE_PORT: 4002
      VITE_STATSERVICE_PORT: 4003
      VITE_AUTHORSERVICE_PORT: 4004
    volumes: 
      - client-code:/app/
      - client-node-modules:/app/node_modules
    command: npm run dev

    networks:
      - library-network
  authorservice:
    build: ./authorservice
    ports:
      - "4004:8080"
    environment:
      PORT: 4004
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/librarydb
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: 123456
      SPRING_MVC_CORS_ENABLED: false
    volumes:
      - ./authorservice:/app 
    command: java -jar ./target/authorservice-0.0.1-SNAPSHOT.jar

    networks:
      - library-network
  statservice:
    image: statservice:1.7
    ports:
      - "4003:4000"
    environment:
      PORT: 4003
      DB_HOST: postgres
      DB_PORT: 35432
      DB_USER: postgres
      DB_PASSWORD: 123456
      DB_NAME: librarydb
    volumes:
      - statservice-code:/app/
      - statservice-node-modules:/app/node_modules
    command: npm run dev

    networks:
      - library-network
  notesservice:
    build: ./notesservice
    ports:
      - "4007:4000"
    environment:
      PORT: 4007
      DB_HOST: postgres
      DB_PORT: 35432
      DB_USER: postgres
      DB_PASSWORD: 123456
      DB_NAME: librarydb
    volumes:
      - notesservice-code:/app/
      - notesservice-node-modules:/app/node_modules
    command: npm run start:dev

    networks:
      - library-network
  categoryservice:
    image: categoryservice:2.5
    ports:
      - "4002:4000"
    environment:
      DATABASE_URL: "postgresql://postgres:123456@postgres:5432/librarydb"
    volumes:
      - categoryservice-code:/app/
      - categoryservice-node-modules:/app/node_modules
    command: npm run dev

    networks:
      - library-network
  bookservice:
    image: bookservice:3.1
    ports:
      - "4001:4000"
    environment:
      PORT: 4001
      DB_HOST: postgres
      DB_PORT: 35432
      DB_USER: postgres
      DB_PASSWORD: 123456
      DB_NAME: librarydb
    volumes:
      - ./bookservice:/app
      - /app/node_modules
    command: npm run dev

    networks:
      - library-network
  excelservice:
    build: ./services/excelservice
    ports:
      - "4006:4000"
    environment:
      PORT: 4006
      DB_HOST: postgres
      DB_PORT: 35432
      DB_USER: postgres
      DB_PASSWORD: 123456
      DB_NAME: librarydb
    command: npm run dev

    networks:
      - library-network
  imageservice:
    build: ./services/imageservice
    ports:
      - "4008:4000"
    environment:
      PORT: 4008
      DB_HOST: postgres
      DB_PORT: 35432
      DB_USER: postgres
      DB_PASSWORD: 123456
      DB_NAME: librarydb
    volumes:
      - imageservice-code:/app/
      - imageservice-node-modules:/app/node_modules
      - ./images:/app/images  
    command: npm run start
    networks:
      - library-network
  postgres:
    image: postgres:latest
    ports:
      - "35432:5432"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: 123456
      POSTGRES_DB: librarydb
    volumes:
      - postgres-data:/var/lib/postgresql/data
      
    networks:
      - library-network

volumes:
  postgres-data:
  authservice-code:
  authservice-node-modules:
  client-code:
  client-node-modules:
  authorservice-code:
  authorservice-node-modules:
  statservice-code:
  statservice-node-modules:
  notesservice-code:
  notesservice-node-modules:
  imageservice-code:
  imageservice-node-modules:
  imageservice-images:
  categoryservice-code:
  categoryservice-node-modules:
  bookservice-code:
  bookservice-node_modules:

networks:
  library-network:
    external:
      name: postgres-network
